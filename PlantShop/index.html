<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>

    <!-- /* ////////BLOCK1//////// */ -->
    <!-- /* ////////BLOCK1//////// */ -->
    <section class="block1">
      <header>
        <a href="#"><img src="image/Logo.svg" alt="logo"></a>
        <nav>
          <a href="servise.html">Service</a>
          <a href="https://t.me/flori_da_ru">Blog</a>
          <a href="">Shop</a>
          <a href="location.html">Location</a>
        </nav>
        <button id="openModalBtn" type="button">Check out(0)</button>

        <!-- Модальное окно с вкладками -->
        <div id="modal" class="modal">
          <div class="modal-content">
            <span id="closeModalBtn" class="close">&times;</span>

            <div class="tabs">
              <button class="tab-button active" data-tab="register">Регистрация</button>
              <button class="tab-button" data-tab="login">Авторизация</button>
            </div>

            <div class="tab-content active" id="register">
              <h2>Регистрация</h2>
              <form>
                <label for="reg-username">Имя пользователя:</label>
                <input type="text" id="reg-username" name="username" required>

                <label for="reg-email">Email:</label>
                <input type="email" id="reg-email" name="email" required>

                <label for="reg-password">Пароль:</label>
                <input type="password" id="reg-password" name="password" required>

                <button type="submit">Зарегистрироваться</button>
              </form>
            </div>

            <div class="tab-content" id="login">
              <h2>Авторизация</h2>
              <form>
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" name="email" required>

                <label for="login-password">Пароль:</label>
                <input type="password" id="login-password" name="password" required>

                <button type="submit">Войти</button>
              </form>
            </div>

          </div>
        </div>
      </header>
      
      <div class="group_text">
        <h1>Let’s find <span> your love</span><br><span class="group_text__green"> plants.</span></h1>
        <h3>Add some color to your home, give it a little attention, the plants will accompany you quietly</h3>
      </div>

      <div class="logos">
        <img src="image/001-plant 1.svg" alt="">
        <img src="image/001-plant 2.svg" alt="">
        <img src="image/001-plant 3.svg" alt="">
        <img src="image/001-plant 4.svg" alt=""> 
      </div>
    </section>

    <!-- /* ////////BLOCK2//////// */ -->
    <!-- /* ////////BLOCK2//////// */ -->

    <section class="block2">
      <div class="block2-top">
        <button type="button">Try for service</button>
        <h3>Get a beautiful home</h3>
        <p>If you don’t know what plants you can add to the space
          We can provide you with selected plants
          And configure your space</p>
      </div>
      <div class="block2-bottom">
        <h1>4 types of plants</h1>
        <div class="block2-botoom_cardholder">
          <div class="block2-bottom_card">
            <img src="image/Rectangle 13.png" alt="">
            <h3>Foliage</h3>
            <h4>21 PLANTS</h4>
          </div>
          <div class="block2-bottom_card">
            <img src="image/Rectangle 13 (1).png" alt="">
            <h3>Pucculent</h3>
            <h4>4 plants</h4>
          </div>
          <div class="block2-bottom_card">
            <img src="image/Rectangle 13 (2).png" alt="">
            <h3>Flower</h3>
            <h4>8 plants</h4>
          </div>
          <div class="block2-bottom_card">
            <img src="image/Rectangle 13 (3).png" alt="">
            <h3>Fruit</h3>
            <h4>10 plants</h4>
          </div>
        </div>
      </div>
    </section>


  </main>

    <script>
      const openModalBtn = document.getElementById('openModalBtn');
      const modal = document.getElementById('modal');
      const closeModalBtn = document.getElementById('closeModalBtn');

      const tabButtons = document.querySelectorAll('.tab-button');
      const tabContents = document.querySelectorAll('.tab-content');

      // Открытие/закрытие модального окна
      openModalBtn.addEventListener('click', () => {
        modal.style.display = 'block';
      });

      closeModalBtn.addEventListener('click', () => {
        modal.style.display = 'none';
      });

      window.addEventListener('click', (event) => {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });

      // Переключение вкладок
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tab = button.getAttribute('data-tab');
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          button.classList.add('active');
          document.getElementById(tab).classList.add('active');
        });
      });

      // Функция для отправки запросов
      async function postData(url = '', data = {}) {
        const response = await fetch(url, {
          method: 'POST',
          credentials: 'include', // важно для куки
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        return response.json();
      }

      // Обработка формы регистрации
      document.querySelector('#register form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('reg-username').value.trim();
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-password').value;

        try {
          const result = await postData('http://localhost:3000/api/register', { username, email, password });
          alert(result.message);
          if (!result.message.includes('ошибка')) {
            // Переключаемся на вкладку входа
            document.querySelector('.tab-button[data-tab="login"]').click();
          }
        } catch (err) {
          alert('Ошибка регистрации');
        }
      });

      // Обработка формы входа
      document.querySelector('#login form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        try {
          const result = await postData('http://localhost:3000/api/login', { email, password });
          if (result.message === 'Успешный вход') {
            alert('Добро пожаловать, ' + result.username + '!');
            modal.style.display = 'none';
            updateUserButton(result.username);
          } else {
            alert(result.message);
          }
        } catch (err) {
          alert('Ошибка входа');
        }
      });

      // Обновление кнопки в header с именем пользователя
      function updateUserButton(username) {
        openModalBtn.textContent = username;
        openModalBtn.disabled = true; // Можно сделать кнопку неактивной или изменить логику
      }

      // Проверка авторизации при загрузке страницы
      async function checkAuth() {
        try {
          const response = await fetch('http://localhost:3000/api/me', {
            credentials: 'include'
          });
          if (response.ok) {
            const data = await response.json();
            updateUserButton(data.username);
          }
        } catch {}
      }

      checkAuth();
    </script>


</body>
</html>